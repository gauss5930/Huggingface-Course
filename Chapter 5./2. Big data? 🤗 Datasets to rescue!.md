# Big data? ğŸ¤— Datasets to the rescue!

ìš”ì¦˜ì—ëŠ” multi-gigabyteì˜ ë°ì´í„°ì…‹ìœ¼ë¡œ ì‘ì—…ì„ í•˜ëŠ” ì‚¬ë¡€ê°€ ê±°ì˜ ë“œë¬¼ë‹¤. 
íŠ¹íˆ, BERTì™€ GPT-2ì™€ ê°™ì€ transformerì„ ë°‘ë°”ë‹¥ë¶€í„° ì‚¬ì „ í•™ìŠµ ì‹œí‚¨ë‹¤ë©´ ë§ì´ë‹¤.
ì´ëŸ¬í•œ ê²½ìš°ì—ëŠ”, dataë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ê²ƒë§Œ í•´ë„ ì—„ì²­ ì–´ë µë‹¤.
ì˜ˆë¥¼ ë“¤ì–´, GPT-2ë¥¼ pre-trianí•˜ëŠ”ë° ì‚¬ìš©ë˜ëŠ” WebGPTì˜ corpusëŠ” 800ë§Œ ê°œ ì´ìƒì˜ ë¬¸ì„œì™€ 40 GBì˜ textë¡œ ì´ë£¨ì–´ì ¸ ìˆë‹¤.
ì´ë ‡ê²Œ ê±°ëŒ€í•œ ë°ì´í„°ë¥¼ ë‹¹ì‹  ë…¸íŠ¸ë¶ì˜ RAMìœ¼ë¡œ ë¶ˆëŸ¬ì˜¨ë‹¤ëŠ” ê²ƒì€ ë…¸íŠ¸ë¶ì„ ì£½ì´ê² ë‹¤ëŠ” ê²ƒê³¼ ë§ˆì°¬ê°€ì§€ë‹¤!! ğŸ˜µ

ë‹¤í–‰íˆë„, ğŸ¤— DatasetsëŠ” ì´ëŸ¬í•œ ì œì•½ì„ ê·¹ë³µí•  ìˆ˜ ìˆë„ë¡ ì„¤ê³„ë˜ì—ˆë‹¤.
ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ë°ì´í„°ì…‹ì„ memory-mapped íŒŒì¼ë¡œ ë‹¤ë¤„ì„œ, memory management ë¬¸ì œì—ì„œ ë²—ì–´ë‚  ìˆ˜ ìˆë„ë¡ í•˜ì˜€ê³ , ì½”í¼ìŠ¤ì˜ í•­ëª©ì„ ìŠ¤íŠ¸ë¦¬ë°í•˜ì—¬ í•˜ë“œ ë“œë¼ì´ë¸Œ ì œí•œì—ì„œ ë²—ì–´ë‚˜ê²Œ í•˜ì˜€ë‹¤.

ì´ë²ˆ ì„¹ì…˜ì—ì„œëŠ” ğŸ¤— Datasetsì˜ ì´ëŸ¬í•œ íŠ¹ì§•ìœ¼ë¡œ 825 GBì˜ corpusë¥¼ ê°€ì§€ê³  ìˆëŠ” 'Pile'ì— ëŒ€í•´ ì•Œì•„ë³¼ ê²ƒì´ë‹¤.
ì ë“œê°€ì~!! ğŸ”¥

### Pileì´ ë¬´ì—‡ì¼ê¹Œ?

Pileì€ EleutherAIì—ì„œ ìƒì„±í•œ English text corpusë¡œ, í° ê·œëª¨ì˜ LMì„ í•™ìŠµì‹œí‚¤ê¸° ìœ„í•´ ë§Œë“¤ì–´ì¡Œë‹¤.
ì´ ë°ì´í„°ì…‹ì€ ë§¤ìš° ë‹¤ì–‘í•œ ë¶„ì•¼ì˜ ë°ì´í„°ë¥¼ ê°€ì§€ê³  ìˆë‹¤.
ì‚¬ìš© ê°€ëŠ¥í•œ í•™ìŠµ ë°ì´íƒ€ë§Œ í•´ë„ 14 GBì˜ chunkë¡œ ì´ë£¨ì–´ì ¸ ìˆê³ , ê°ê°ì˜ ìš”ì†Œ ë˜í•œ ë‹¤ìš´ë¡œë“œí•  ìˆ˜ ìˆë‹¤.
ìš°ì„  PubMed Abstracts ë°ì´í„°ì…‹ë¶€í„° ì‚´í´ë³´ì.
ì´ ë°ì´í„°ì…‹ì€ PubMedì—ì„œ ë‚˜ì˜¨ 1,500ë§Œ ê°œì˜ biomedical ì €ì‘ë¬¼ì˜ abstract corpusì´ë‹¤.
ë°ì´í„°ì…‹ì€ JSON Lines formatìœ¼ë¡œ zstandard ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•´ì„œ í•¨ì¶•ë˜ì—ˆê¸° ë•Œë¬¸ì—, ìš°ì„  ì´ê²ƒì„ install í•´ì•¼ í•œë‹¤.

``` python
!pip install zstandard
```

ë‹¤ìŒìœ¼ë¡œ, ì´ì „ ì„¹ì…˜ì—ì„œ ë°°ì› ë˜ ë©€ë¦¬ ë–¨ì–´ì ¸ ìˆëŠ” ë°©ë²•ì„ ì‚¬ìš©í•´ì„œ ë°ì´í„°ì…‹ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆë‹¤.

``` python
from datasets import load_dataset

# ì´ ì½”ë“œëŠ” ì‹¤í–‰ë˜ëŠ”ë° ì•½ê°„ì˜ ì‹œê°„ì´ ì†Œìš”ë˜ê¸° ë•Œë¬¸ì—, ì ì‹œ ì°¨ë‚˜ ì»¤í”¼ë¥¼ ë§ˆì‹œë©´ì„œ ê¸°ë‹¤ë ¤ë³´ì•„ìš”~
data_files = "https://the-eye.eu/public/AI/pile_preliminary_components/PUBMED_title_abstracts_2019_baseline.jsonl.zst"
pubmed_dataset = load_dataset("json", data_files=data_files, split="train")
pubmed_dataset
```

``` python
Dataset({
    features: ['meta', 'text'],
    num_rows: 15518009
})
```

ìœ„ì˜ ê²°ê³¼ë¥¼ ë³´ë©´, 15,518,009ê°œì˜ í–‰ê³¼ 2ê°œì˜ ì—´ë¡œ ì´ë£¨ì–´ì§„ ë°ì´í„°ì…‹ì´ë¼ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.
ì§„ì§œ ì—„ì²­ ë§ë‹¤!! ğŸ˜²

ì²« ë²ˆì§¸ exampleì„ êº¼ë‚´ì„œ í•œ ë²ˆ í™•ì¸í•´ë³´ë„ë¡ í•˜ì.

``` python
pubmed_dataset[0]
```

``` python
{'meta': {'pmid': 11409574, 'language': 'eng'},
 'text': 'Epidemiology of hypoxaemia in children with acute lower respiratory infection.\nTo determine the prevalence of hypoxaemia in children aged under 5 years suffering acute lower respiratory infections (ALRI), the risk factors for hypoxaemia in children under 5 years of age with ALRI, and the association of hypoxaemia with an increased risk of dying in children of the same age ...'}
```

 ì˜¤ì¼€ì´! ì´ exampleì€ medical ê¸°ì‚¬ì˜ abstractì²˜ëŸ¼ ë³´ì¸ë‹¤.
 ì´ì œ ì´ ë°ì´í„°ì…‹ì„ ë¶ˆëŸ¬ì˜¤ê¸° ìœ„í•´ ì–¼ë§Œí¼ì˜ RAMì„ ì‚¬ìš©í•˜ì˜€ëŠ”ì§€ ì•Œì•„ë³´ë„ë¡ í•˜ì.
 
 ### memory mappingì˜ ë§ˆìˆ  ğŸª„
 
 Pythonì—ì„œ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì„ ì¸¡ì •í•˜ëŠ” ê°„ë‹¨í•œ ë°©ë²•ì€ psutil ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ë‹¤.
 ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” pipì„ ì´ìš©í•˜ì—¬ ë‹¤ìŒê³¼ ê°™ì´ ì„¤ì¹˜í•  ìˆ˜ ìˆë‹¤.
 
 ``` python
 !pip install psutil
 ```
 
 ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” Process í´ë˜ìŠ¤ë¥¼ ì œê³µí•˜ëŠ”ë°, ì´ í´ë˜ìŠ¤ëŠ” í˜„ì¬ í”„ë¡œì„¸ìŠ¤ê°€ ë©”ëª¨ë¦¬ë¥¼ ì–¼ë§ˆë‚˜ ì‚¬ìš©í•˜ëŠ”ì§€ í™•ì¸í•´ì¤€ë‹¤.
 
 ``` python
 import psutil
 
 # Process.memory_infoëŠ” byteë¡œ í‘œí˜„ë˜ì„œ, megabyteë¡œ ë³€í™˜í•˜ì˜€ë‹¤.
 print(f"RAM used: {psutil.Process().memory_info().rss / (1024 * 1024):.2f} MB")
 ```
 
 ``` python
 RAM used: 5678.33 MB
 ```
 
 ì—¬ê¸°ì„œ rssëŠ” resident set sizeì˜ ì¤„ì„ë§ë¡œ, í”„ë¡œì„¸ìŠ¤ê°€ RAMì—ì„œ ì°¨ì§€í•˜ëŠ” ë©”ëª¨ë¦¬ì˜ ì¼ë¶€ì´ë‹¤.
 ì´ëŸ¬í•œ ì¸¡ì •ì€ Python Interpreterê°€ ì‚¬ìš©í•˜ëŠ” ë©”ëª¨ë¦¬ì™€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë©”ëª¨ë¦¬ë„ í¬í•¨í•˜ê¸° ë•Œë¬¸ì—, ì‹¤ì œë¡œ ë°ì´í„°ì…‹ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‚¬ìš©ëœ ë©”ëª¨ë¦¬ëŠ” ë”ìš± ì ë‹¤.
 ë¹„êµë¥¼ ìœ„í•´, dataset_sizeë¥¼ ì‚¬ìš©í•´ì„œ ë””ìŠ¤í¬ì— ìˆëŠ” ë°ì´í„°ì…‹ì´ ì–¼ë§ˆë‚˜ í° ì§€ ì•Œì•„ë³´ì•˜ë‹¤.
 ê²°ê³¼ëŠ” ì´ì „ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ byteë¡œ í‘œí˜„ë˜ê¸° ë•Œë¬¸ì—, ì´ë¥¼ gigabyteë¡œ ìˆ˜ë™ìœ¼ë¡œ ë°”ê¿”ì•¼ í•œë‹¤.
 
 ``` python
 print(f"Number of files in dataset : {pubmed_dataset.dataset_size}")
size_gb = pubmed_dataset.dataset_size / (1024**3)
print(f"Dataset size (cache file) : {size_gb:.2f} GB")
 ```
 
 ``` python
Number of files in dataset : 20979437051
Dataset size (cache file) : 19.54 GB
 ```
 
 20 GBì— ë‹¬í•˜ëŠ” ìš©ëŸ‰ì„ ê°€ì§€ê³  ìˆëŠ”ë°, ë°ì´í„°ì…‹ì— ë”ìš± ì ì€ ì–‘ì˜ RAMì„ ì‚¬ìš©í•´ì„œ ë°ì´í„°ì…‹ì„ ë¶ˆëŸ¬ì˜¤ê³  ì ‘ê·¼í•  ìˆ˜ ìˆì—ˆë‹¤.
 
 ğŸ¤— DatasetsëŠ” ê°ê°ì˜ ë°ì´í„°ì…‹ì„ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë°ì´í„°ì…‹ì„ ë©”ëª¨ë¦¬ì— ì™„ì „íˆ ë¡œë“œí•˜ì§€ ì•Šê³ ë„ ë°ì´í„°ì…‹ì˜ ìš”ì†Œì— ì ‘ê·¼í•˜ê³  ì‘ë™í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” RAMê³¼ íŒŒì¼ ì‹œìŠ¤í…œ ì €ì¥ì†Œ ê°„ì˜ ë§¤í•‘ì„ ì œê³µí•˜ëŠ” memory-mapped fileë¡œ ë‹¤ë£¬ë‹¤.

Memory-mapped fileì€ ì—¬ëŸ¬ ê°œì˜ í”„ë¡œì„¸ìŠ¤ì— ê±¸ì³ì„œ ê³µìœ ë  ìˆ˜ ìˆëŠ”ë°, ì´ëŠ” methodê°€ Dataset.map()ì²˜ëŸ¼ ë°ì´í„°ì…‹ì„ ì—†ì• ê±°ë‚˜ ì˜®ê¸¸ í•„ìš”ì—†ì´ ë³‘ë ¬í™”ë  ìˆ˜ ìˆë„ë¡ í•´ì¤€ë‹¤.
ì´ëŸ¬í•œ ê¸°ëŠ¥ì€ ëª¨ë‘ Apache Arrow ë©”ëª¨ë¦¬ í˜•ì‹ ë° pyarrow ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ì˜í•´ ì‹¤í˜„ë˜ì–´ ë°ì´í„° ë¡œë“œ ë° ì²˜ë¦¬ ì†ë„ê°€ ë§¤ìš° ë¹ ë¥´ë‹¤.
ì´ê²ƒì´ ì‘ë™í•˜ëŠ” ê²ƒì„ ë³´ê¸° ìœ„í•´, PubMed Abstracts ë°ì´í„°ì…‹ì˜ ëª¨ë“  ìš”ì†Œë¥¼ ë°˜ë³µí•¨ìœ¼ë¡œì¨ ìê·¸ë§ˆí•œ ìŠ¤í”¼ë“œ í…ŒìŠ¤íŠ¸ë¥¼ í•´ë³´ë„ë¡ í•˜ì.

``` python
import timeit

code_snippet = """batch_size = 1000

for idx in range(0, len(pubmed_dataset), batch_size):
    _ = pubmed_dataset[idx:idx + batch_size]
"""

time = timeit.timeit(stmt=code_snippet, number=1, globals=globals())
print(
    f"Iterated over {len(pubmed_dataset)} examples (about {size_gb:.1f} GB) in "
    f"{time:.1f}s, i.e. {size_gb/time:.3f} GB/s"
)
```

``` python
'Iterated over 15518009 examples (about 19.5 GB) in 64.2s, i.e. 0.304 GB/s'
```

ì—¬ê¸°ì„œ Pythonì˜ timeit ëª¨ë“ˆì„ ì‚¬ìš©í•˜ì—¬ code_snippetì— ê±¸ë¦¬ëŠ” ì‹¤í–‰ ì‹œê°„ì„ ì¸¡ì •í•˜ì˜€ë‹¤.
ë³´í†µ ìˆ˜ì‹­ GB/sì—ì„œ ëª‡ GB/sì˜ ì†ë„ë¡œ ë°ì´í„°ì…‹ì— ëŒ€í•´ ë°˜ë³µí•  ìˆ˜ ìˆë‹¤.
ì´ëŸ¬í•œ ì‘ì—…ì€ ê´‘ëŒ€í•œ ë‹¤ìˆ˜ì˜ ì‘ìš©ì— ì¢‹ì§€ë§Œ, ê°€ë”ì€ ë°ì´í„°ì…‹ì´ ë„ˆë¬´ ì»¤ì„œ í•˜ë“œ ë“œë¼ì´ë¸Œì— ì €ì¥í•  ìˆ˜ ì—†ëŠ” ê²½ìš°ë„ ìˆë‹¤.
ì˜ˆë¥¼ ë“¤ì–´, Pile ë°ì´í„°ì…‹ì„ í†µì§¸ë¡œ ë‹¤ìš´ ë°›ê²Œëœë‹¤ë©´, 825 GBì˜ ê³µê°„ì´ í•„ìš”í•˜ë‹¤! ğŸ˜µ 
ì´ëŸ¬í•œ ê²½ìš°ë¥¼ ë‹¤ë£¨ê¸° ìœ„í•´ì„œ, ğŸ¤— DatasetsëŠ” ì „ì²´ ë°ì´í„°ì…‹ì„ ë‹¤ìš´í•  í•„ìš”ì—†ì´, ì¦‰ì„ì—ì„œ ë‹¤ìš´í•˜ê³  ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” streaming featureì„ ì œê³µí•œë‹¤.

### Streaming datasets

dataset streamingì„ ê°€ëŠ¥í•˜ê²Œ í•˜ê¸° ìœ„í•´ì„œëŠ”, streaming=Trueë¥¼ load_dataset() í•¨ìˆ˜ì— í˜ë ¤ë³´ë‚´ë©´ ëœë‹¤.
ì˜ˆë¥¼ ë“¤ì–´, PubMed Abstracts ë°ì´í„°ì…‹ì„ ë‹¤ì‹œ ë¶ˆëŸ¬ì™€ë³´ì. í•˜ì§€ë§Œ, streaming modeì—ì„œ ë§ì´ë‹¤.

``` python
pubmed_dataset_streamed = load_dataset(
    "json", data_files=data_files, split="train", streaming=True
)
```

ì´ë²ˆ ì±•í„°ì—ì„œ ë‹¤ë¤˜ë˜ ìµìˆ™í•œ Dataset ëŒ€ì‹ ì—, streaming=Trueë¡œ ë°˜í™˜ëœ objectëŠ” IterableDatasetì´ë‹¤.
ì´ë¦„ì—ì„œë¶€í„° ì•Œ ìˆ˜ ìˆë“¯ì´, IterableDatasetì˜ ìš”ì†Œë“¤ì— ì ‘ê·¼í•˜ê¸° ìœ„í•´ì„œëŠ” ì´ë¥¼ ë°˜ë³µí•´ì•¼ í•  í•„ìš”ê°€ ìˆë‹¤.
ìš°ë¦¬ì˜ streamed datasetì˜ ì²« ë²ˆì§¸ ìš”ì†Œë¥¼ ë‹¤ìŒê³¼ ê°™ì´ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

``` python
next(iter(pubmed_dataset_streamed))
```

``` python
{'meta': {'pmid': 11409574, 'language': 'eng'},
 'text': 'Epidemiology of hypoxaemia in children with acute lower respiratory infection.\nTo determine the prevalence of hypoxaemia in children aged under 5 years suffering acute lower respiratory infections (ALRI), the risk factors for hypoxaemia in children under 5 years of age with ALRI, and the association of hypoxaemia with an increased risk of dying in children of the same age ...'}
```

streamed datasetì˜ ìš”ì†Œë“¤ì€ IterableDataset.map()ì„ ì‚¬ìš©í•´ì„œ ì¦‰ì„ì—ì„œ ì²˜ë¦¬ë  ìˆ˜ ìˆë‹¤.
IterableDataset.map()ì€ í•™ìŠµ ì¤‘ì— inputì„ í† í°í™”í•´ì•¼ í•  ë•Œ ìœ ìš©í•˜ë‹¤.
ì²˜ë¦¬ ê³¼ì •ì€ Chapter 3. ì—ì„œ ì‚¬ìš©í•œ í† í°í™”ì™€ ì™„ë²½íˆ ë˜‘ê°™ë‹¤.
ìœ ì¼í•˜ê²Œ ë‹¤ë¥¸ ì ì€ outputì´ í•˜ë‚˜ë¡œ ë°˜í™˜ëœë‹¤ëŠ” ê²ƒì´ë‹¤.

``` python
from transformers import AutoTokenizer

tokenizer = AutoTokenizer.from_pretrained("distilbert-base-uncased")
tokenized_dataset = pubmed_dataset_streamed.map(lambda x: tokenizer(x["text"]))
next(iter(tokenized_dataset))
```

``` python
{'input_ids': [101, 4958, 5178, 4328, 6779, ...], 'attention_mask': [1, 1, 1, 1, 1, ...]}
```

streamed datasetì„ IterableDataset.shuffle()ì„ ì‚¬ìš©í•˜ì—¬ ì…”í”Œí•  ìˆ˜ ìˆì§€ë§Œ, Dataset.shuffle()ê³¼ ë‹¬ë¦¬ ì´ê²ƒì€ ì‚¬ì „ì— ì •ì˜ë„ë‹ˆ buffer_sizeì˜ ìš”ì†Œë§Œ ì…”í”Œí•œë‹¤.

``` python
shuffled_dataset = pubmed_dataset_streamed.shuffle(buffer_size=10_000, seed=42)
next(iter(shuffled_dataset))
```

``` python
{'meta': {'pmid': 11410799, 'language': 'eng'},
 'text': 'Randomized study of dose or schedule modification of granulocyte colony-stimulating factor in platinum-based chemotherapy for elderly patients with lung cancer ...'}
```

ì´ ì˜ˆì‹œì—ì„œ, ë²„í¼ì˜ ì²« 10,000ê°œì˜ exampleë¡œë¶€í„° ëœë¤í•˜ê²Œ exampleì„ ì„ íƒí•˜ê²Œ í•œë‹¤.
exampleì— ëŒ€í•´ ì ‘ê·¼ì´ ë˜ë©´, ë²„í¼ì—ì„œì˜ ì´ê²ƒì˜ spotì€ corpusì˜ ë‹¤ìŒ exampleë¡œ ì±„ì›Œì§„ë‹¤.
ê·¸ë¦¬ê³  IterableDataset.take()ì™€ IterableDataset.skip() í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ì„œ streamed datasetë¡œë¶€í„° ìš”ì†Œë“¤ì„ ì„ íƒí•´ì˜¬ ìˆ˜ ìˆë‹¤.
ì´ ë°©ë²•ì€ Dataset.select() ì™€ ìœ ì‚¬í•˜ë‹¤.
ì˜ˆë¥¼ ë“¤ì–´, PubMed Abstracts ë°ì´í„°ì…‹ì˜ ì²« 5ê°œì˜ exampleì„ ê³ ë¥´ë ¤ë©´ ë‹¤ìŒê³¼ ê°™ì´ í•˜ë©´ ëœë‹¤.

``` python
dataset_head = pubmed_dataset_streamed.take(5)
list(dataset_head)
```

``` python
[{'meta': {'pmid': 11409574, 'language': 'eng'},
  'text': 'Epidemiology of hypoxaemia in children with acute lower respiratory infection ...'},
 {'meta': {'pmid': 11409575, 'language': 'eng'},
  'text': 'Clinical signs of hypoxaemia in children with acute lower respiratory infection: indicators of oxygen therapy ...'},
 {'meta': {'pmid': 11409576, 'language': 'eng'},
  'text': "Hypoxaemia in children with severe pneumonia in Papua New Guinea ..."},
 {'meta': {'pmid': 11409577, 'language': 'eng'},
  'text': 'Oxygen concentrators and cylinders ...'},
 {'meta': {'pmid': 11409578, 'language': 'eng'},
  'text': 'Oxygen supply in rural africa: a personal experience ...'}]
```

ì´ì™€ ìœ ì‚¬í•˜ê²Œ, IterableDataset.skip() í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ì„œ shuffled datasetì—ì„œ trainingê³¼ validation splitì„ ë‹¤ìŒê³¼ ê°™ì´ ë§Œë“¤ ìˆ˜ ìˆë‹¤.

``` python
# ì²« 1,000ê°œì˜ exampleì€ skipí•˜ê³ , ë‚¨ì€ exampleì„ training setë¡œ ë°›ìŒ
train_dataset = shuffled_dataset.skip(1000)
# ì²« 1,000ê°œì˜ exampleì„ validation setìœ¼ë¡œ ë°›ìŒ
validation_dataset = shuffled_dataset.take(1000)
```

ê³µí†µ applicationì„ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ì…‹ ìŠ¤íŠ¸ë¦¬ë°ì— ëŒ€í•œ íƒìƒ‰ì„ ë§ˆë¬´ë¦¬í•˜ê² ë‹¤.
ê·¸ëŸ¬ê¸° ìœ„í•´, ì¼ë‹¨ ì—¬ëŸ¬ ë°ì´í„°ì…‹ì„ í•¨ê»˜ ê²°í•©í•˜ì—¬ ë‹¨ì¼ corpusë¥¼ ìƒì„±í•œë‹¤.
ğŸ¤— DatasetsëŠ” IterableDataset object ë¦¬ìŠ¤íŠ¸ë¥¼ í•˜ë‚˜ì˜ IterableDatasetìœ¼ë¡œ ë³€í™˜í•˜ëŠ” interleave_datasets() í•¨ìˆ˜ë¥¼ ì œê³µí•œë‹¤.
ì—¬ê¸°ì„œ ìƒˆë¡œìš´ ë°ì´í„°ì…‹ì˜ ìš”ì†Œë“¤ì€ ì†ŒìŠ¤ exampleì„ ë²ˆê°ˆì•„ ê°€ë©° ì‚¬ìš©í•¨ìœ¼ë¡œì¨ ì–»ì–´ì§„ë‹¤.
ì´ëŸ¬í•œ í•¨ìˆ˜ëŠ” ì»¤ë‹¤ë€ ë°ì´í„°ì…‹ì„ í•©ì¹  ë•Œ íŠ¹íˆ ìœ ìš©í•˜ê²Œ ì‚¬ìš©ëœë‹¤.
ì˜ˆì œë¡œ Pileì˜ FreeLaw ì„œë¸Œì…‹ì„ streamí•´ë³´ë„ë¡ í•˜ì.

``` python
law_dataset_streamed = load_dataset(
    "json",
    data_files="https://the-eye.eu/public/AI/pile_preliminary_components/FreeLaw_Opinions.jsonl.zst",
    split="train",
    streaming=True,
)
next(iter(law_dataset_streamed))
```

``` python
{'meta': {'case_ID': '110921.json',
  'case_jurisdiction': 'scotus.tar.gz',
  'date_created': '2010-04-28T17:12:49Z'},
 'text': '\n461 U.S. 238 (1983)\nOLIM ET AL.\nv.\nWAKINEKONA\nNo. 81-1581.\nSupreme Court of United States.\nArgued January 19, 1983.\nDecided April 26, 1983.\nCERTIORARI TO THE UNITED STATES COURT OF APPEALS FOR THE NINTH CIRCUIT\n*239 Michael A. Lilly, First Deputy Attorney General of Hawaii, argued the cause for petitioners. With him on the brief was James H. Dannenberg, Deputy Attorney General...'}
```

ì´ ë°ì´í„°ì…‹ì€ ë¡œë“œí•˜ëŠ”ë°ë§Œ ë³´í†µì˜ ë…¸íŠ¸ë¶ì—ì„œëŠ” RAMì— ì—„ì²­ë‚œ ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ ì¤˜ì•¼í•  ë§Œí¼ í¬ì§€ë§Œ, ìš°ë¦¬ëŠ” ì–´ë µì§€ ì•Šê²Œ ë°ì´í„°ì…‹ì„ ë¶ˆëŸ¬ì˜¤ê³  ì ‘ê·¼í•  ìˆ˜ ìˆì—ˆë‹¤! ğŸ˜Š
ê·¸ëŸ¬ë©´ ì´ì œ FreeLawì™€ PubMed Abstracts ë°ì´í„°ì…‹ì˜ exampleì„ interleave_datasets() í•¨ìˆ˜ë¡œ í•©ì³ë³´ë„ë¡ í•˜ì.

``` python
from itertools import islice
from datasets import interleave_datasets

combined_dataset = interleave_datasets([pubmed_dataset_streamed, law_dataset_streamed])
list(islice(combined_dataset, 2))
```

``` python
[{'meta': {'pmid': 11409574, 'language': 'eng'},
  'text': 'Epidemiology of hypoxaemia in children with acute lower respiratory infection ...'},
 {'meta': {'case_ID': '110921.json',
   'case_jurisdiction': 'scotus.tar.gz',
   'date_created': '2010-04-28T17:12:49Z'},
  'text': '\n461 U.S. 238 (1983)\nOLIM ET AL.\nv.\nWAKINEKONA\nNo. 81-1581.\nSupreme Court of United States.\nArgued January 19, 1983.\nDecided April 26, 1983.\nCERTIORARI TO THE UNITED STATES COURT OF APPEALS FOR THE NINTH CIRCUIT\n*239 Michael A. Lilly, First Deputy Attorney General of Hawaii, argued the cause for petitioners. With him on the brief was James H. Dannenberg, Deputy Attorney General...'}]
```

ì—¬ê¸°ì„œ Pythonì˜ itertools ëª¨ë“ˆì˜ islice() í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ì„œ í†µí•© ë°ì´í„°ì…‹ì˜ ì²« ë‘ ê°œ exampleì„ ì„ íƒí•˜ê²Œ í•˜ê³ , ë‘ ì†ŒìŠ¤ ë°ì´í„°ì…‹ ê°ê°ì˜ ì²« ë²ˆì§¸ ì˜ˆì™€ ì¼ì¹˜í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.

ë§ˆì§€ë§‰ìœ¼ë¡œ íŒŒì¼ ì „ì²´ë¥¼ 825 GBë¡œ ìŠ¤íŠ¸ë¦¬ë°í•˜ë ¤ë©´ ë‹¤ìŒê³¼ ê°™ì´ ì¤€ë¹„ëœ ëª¨ë“  íŒŒì¼ì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.

``` python
base_url = "https://the-eye.eu/public/AI/pile/"
data_files = {
    "train": [base_url + "train/" + f"{idx:02d}.jsonl.zst" for idx in range(30)],
    "validation": base_url + "val.jsonl.zst",
    "test": base_url + "test.jsonl.zst",
}
pile_dataset = load_dataset("json", data_files=data_files, streaming=True)
next(iter(pile_dataset["train"]))
```

``` python
{'meta': {'pile_set_name': 'Pile-CC'},
 'text': 'It is done, and submitted. You can play â€œSurvival of the Tastiestâ€ on Android, and on the web...'}
```
