# Slice & Dice

ì•ìœ¼ë¡œë„ ë§ì€ taskë¥¼ ì§„í–‰í• í…ë°, ëŒ€ë¶€ë¶„ì˜ ê²½ìš°ì—ëŠ” ì´ ë°ì´í„°ê°€ modelì— ì í•©í•˜ì§€ ì•Šì€ í˜•íƒœì¼ ê²ƒì´ë‹¤.
ê·¸ë˜ì„œ ì´ë²ˆ ì„¹ì…˜ì—ì„œëŠ” ğŸ¤— Datasets ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì œê³µí•˜ëŠ” dataset cleaning featureë“¤ì„ ì‚´í´ë³´ë„ë¡ í•˜ê² ë‹¤.

### Slicing & Dicing data

Pandasì™€ ìœ ì‚¬í•˜ê²Œ, ğŸ¤— DatasetsëŠ” Datasetê³¼ DatasetDict objectì— ëŒ€í•´ì„œ ì¡°ì¢…í•  ìˆ˜ ìˆëŠ” ë‹¤ì–‘í•œ í•¨ìˆ˜ë¥¼ ì œê³µí•œë‹¤.
ì´ë¯¸, Chapter 3. ì—ì„œ ìš°ë¦¬ëŠ” Dataset.map() methodë¥¼ ê²½í—˜í•˜ì˜€ë‹¤.
ë”°ë¼ì„œ ì´ë²ˆ ì„¹ì…˜ì—ì„œëŠ” ì´ ì™¸ì— ë”ìš± ë‹¤ì–‘í•œ í•¨ìˆ˜ë“¤ì— ëŒ€í•´ ì•Œì•„ë³´ë„ë¡ í•˜ê² ë‹¤! ğŸ”¥

ì˜ˆì‹œë¥¼ ë³´ì—¬ì£¼ê¸° ìœ„í•´ ì‚¬ìš©í•  ë°ì´í„°ì…‹ì€ [UC Irvine Machine Learning Repository](https://archive.ics.uci.edu/ml/index.php) [Drug Review Dataset](https://archive.ics.uci.edu/ml/datasets/Drug+Review+Dataset+%28Drugs.com%29)ìœ¼ë¡œ ì§„í–‰í•˜ê² ë‹¤.
ì´ ë°ì´í„°ì…‹ì€ ë‹¤ì–‘í•œ ì•½í’ˆì— ëŒ€í•œ í™˜ìë“¤ì˜ ë¦¬ë·°ì™€ ì•½ì„ ë³µìš©í–ˆì„ ë•Œ ì»¨ë””ì…˜ì˜ ë³€í™”ë¥¼ 10ì  ë§Œì ìœ¼ë¡œ í•´ì„œ í‰ê°€í•˜ê³  ìˆë‹¤.

ê°€ì¥ ì²˜ìŒìœ¼ë¡œ í•´ì•¼í•  ê²ƒì€ ë°ì´í„°ë¥¼ ë‹¤ìš´ë¡œë“œí•˜ê³  ì¶”ì¶œí•˜ëŠ” ê²ƒì´ë‹¤.
ì´ëŠ” wgetê³¼ unzip ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•´ì„œ í•  ìˆ˜ ìˆë‹¤.

``` python
!wget "https://archive.ics.uci.edu/ml/machine-learning-databases/00462/drugsCom_raw.zip"
!unzip drugsCom_raw.zip
```

TSVëŠ” CSVì˜ ë³€í˜•ìœ¼ë¡œ tabì„ separatorë¡œ ë°›ëŠ”ë‹¤.
ì´ëŸ¬í•œ í˜•ì‹ì˜ íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¬ ë•ŒëŠ”, csvë¥¼ ë¶ˆëŸ¬ì˜¬ ë•Œë‘ ë˜‘ê°™ì€ë° load_dataset()ì˜ delimiter ì¸ìë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ëª…ì‹œí•´ì„œ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

``` python
from datasets import load_dataset

data_files = {"train": "drugsComTrain_raw.tsv", "test": "drugsComTest_raw.tsv"}
# \tëŠ” Pythonì—ì„œ tabì„ ì˜ë¯¸í•œë‹¤.
drug_dataset = load_dataset("csv", data_files=data_files, delimiter="\t")
```

ì–´ë– í•œ ì¢…ë¥˜ì˜ ë°ì´í„°ë¡œ ì‘ì—…ì„ í•˜ë“ , ê·¸ ë°ì´í„°ì˜ ìœ í˜•ì— ëŒ€í•´ ë¹ ë¥´ê²Œ í™•ì¸í•˜ëŠ” ë°©ë²•ì€ ëœë¤í•˜ê²Œ ì†ŒëŸ‰ì˜ ë°ì´í„°ë¥¼ ì¶”ì¶œí•´ì„œ í™•ì¸í•´ë³´ëŠ” ê²ƒì´ë‹¤.
ğŸ¤— Datasetsì—ì„œëŠ”, Dataset.shuffle()ê³¼ Dataset.select() í•¨ìˆ˜ë¥¼ ì—°ê²°í•´ì„œ ëœë¤í•˜ê²Œ ìƒ˜í”Œë§í•  ìˆ˜ ìˆë‹¤.

``` python
drug_sample = drug_dataset["train"].shuffle(seed=42).select(range(1000))
# ì²˜ìŒ ëª‡ ê°œì˜ ì˜ˆì‹œ ì‚´í´ë³´ê¸°
drug_sample[:3]
```

``` python
{'Unnamed: 0': [87571, 178045, 80482],
 'drugName': ['Naproxen', 'Duloxetine', 'Mobic'],
 'condition': ['Gout, Acute', 'ibromyalgia', 'Inflammatory Conditions'],
 'review': ['"like the previous person mention, I&#039;m a strong believer of aleve, it works faster for my gout than the prescription meds I take. No more going to the doctor for refills.....Aleve works!"',
  '"I have taken Cymbalta for about a year and a half for fibromyalgia pain. It is great\r\nas a pain reducer and an anti-depressant, however, the side effects outweighed \r\nany benefit I got from it. I had trouble with restlessness, being tired constantly,\r\ndizziness, dry mouth, numbness and tingling in my feet, and horrible sweating. I am\r\nbeing weaned off of it now. Went from 60 mg to 30mg and now to 15 mg. I will be\r\noff completely in about a week. The fibro pain is coming back, but I would rather deal with it than the side effects."',
  '"I have been taking Mobic for over a year with no side effects other than an elevated blood pressure.  I had severe knee and ankle pain which completely went away after taking Mobic.  I attempted to stop the medication however pain returned after a few days."'],
 'rating': [9.0, 3.0, 10.0],
 'date': ['September 2, 2015', 'November 7, 2011', 'June 5, 2013'],
 'usefulCount': [36, 13, 128]}
```

ì¬í˜„ì„±ì„ ìœ„í•´ì„œ Dataset.shuffle()ì˜ seedë¥¼ ìˆ˜ì •í•˜ì˜€ë‹¤.
Dataset.select()ëŠ” ë°˜ë³µì ì¸ indexë¥¼ ì˜ˆìƒí•˜ë¯€ë¡œ range(1000)ì„ ì „ë‹¬í•˜ì—¬ ì…”í”Œëœ ë°ì´í„°ì…‹ì—ì„œ ì²˜ìŒ 1,000ê°œì˜ ì˜ˆì œë¥¼ ê°€ì ¸ì™”ë‹¤.
ì´ ë°ì´í„°ì…‹ì—ì„œ ë‚˜ì˜¨ ìƒ˜í”Œì—ì„œ ìš°ë¦¬ëŠ” ì´ë¯¸ ëª‡ ê°œì˜ ì´ìƒí•œ ì ì„ íŒŒì•…í•  ìˆ˜ ìˆë‹¤.

- Unnamed: 0 ì—´ì€ ê° í™˜ìì— ëŒ€í•´ ìµëª…í™”ëœ IDì²˜ëŸ¼ ì˜ì‹¬ìŠ¤ëŸ½ê²Œ ë³´ì¸ë‹¤.
- condition ì—´ì€ ëŒ€ë¬¸ìì™€ ì†Œë¬¸ì ë¼ë²¨ì„ ì´ˆí•¨í•˜ê³  ìˆë‹¤.
- ë¦¬ë·°ë“¤ì€ ì„œë¡œ ë‹¤ë¥¸ ë‹¤ì–‘í•œ ê¸¸ì´ì™€ Pythonì˜ line separator(\r \n) ë¿ë§Œ ì•„ë‹ˆë¼ HTMLì˜ character code(&\#039)ì˜ ì¡°í•©ìœ¼ë¡œ ì´ë£¨ì–´ì ¸ ìˆë‹¤.

ìœ„ì—ì„œ ë‚˜ì—´í•œ ê°ê°ì˜ ì´ìŠˆë“¤ì— ëŒ€í•´ì„œ ì–´ë–»ê²Œ ğŸ¤— Datasetsë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ”ì§€ ì•Œì•„ë³´ì.
Unnamed: 0 ì—´ì— ëŒ€í•œ í™˜ì ID ê°€ì„¤ì„ í…ŒìŠ¤íŠ¸í•˜ë ¤ë©´, Dataset.unique() í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ì„œ ID ìˆ˜ê°€ ê° splitì˜ í–‰ ìˆ˜ì™€ ì¼ì¹˜í•˜ëŠ” ì§€ í™•ì¸í•˜ë©´ ëœë‹¤.

``` python
for split in drug_dataset.keys():
    assert len(drug_dataset[split]) == len(drug_dataset[split].unique("Unnamed: 0"))
```

ì´ë ‡ê²Œ í•˜ë©´ ì´ ê°€ì„¤ì„ í™•ì¸í•˜ëŠ” ê²ƒì²˜ëŸ¼ ë³´ì¸ë‹¤.
ê·¸ë ‡ë‹¤ë©´ Unnamed: 0 ì—´ì„ ì¢€ ë” í•´ì„ ê°€ëŠ¥í•œ ì´ë¦„ìœ¼ë¡œ ë³€ê²½í•´ì„œ, ë°ì´í„°ì…‹ì„ ì¢€ ë” ì •ë¦¬í•´ë³´ì.
DatasetDict.rename_column() í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ì„œ ë‘ splitì˜ ì—´ì˜ ì´ë¦„ì„ í•œ ë²ˆì— ë³€ê²½í•  ìˆ˜ ìˆë‹¤.

``` python
drug_dataset = drug_dataset.rename_column(
    original_column_name="Unnamed: 0", new_column_name="patient_id"
)
drug_dataset
```

``` python
DatasetDict({
    train: Dataset({
        features: ['patient_id', 'drugName', 'condition', 'review', 'rating', 'date', 'usefulCount'],
        num_rows: 161297
    })
    test: Dataset({
        features: ['patient_id', 'drugName', 'condition', 'review', 'rating', 'date', 'usefulCount'],
        num_rows: 53766
    })
})
```

ë‹¤ìŒìœ¼ë¡œ, Dataset.map()ì„ ì‚¬ìš©í•´ì„œ condition ë¼ë²¨ì„ ì •ê·œí™”í•´ë³´ì.
Chapter 3. ì—ì„œ tokenizationìœ¼ë¡œ í–ˆë˜ ê²ƒì²˜ëŸ¼, drug_datasetì˜ ê° splitì˜ ëª¨ë“  í–‰ì— ëŒ€í•´ ì ìš©ë  ìˆ˜ ìˆëŠ” ê°„ë‹¨í•œ í•¨ìˆ˜ë¥¼ ì •ì˜í•´ë³´ì.

``` python
def lowercase_condition(example):
    return {"condition": example["condtion"].lower()}
    
drug_dataset.map(lowercase_condition)
```

``` python
AttributeError: 'NoneType' object has no attribute 'lower'
```

í•˜ì§€ë§Œ map í•¨ìˆ˜ì— ëŒ€í•´ ë‹¤ìŒê³¼ ê°™ì€ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.. ğŸ˜¢
ì´ ì˜¤ë¥˜ë¡œë¶€í„° condition ì—´ì— ë¬¸ìì—´ë¡œ ì†Œë¬¸ì ë³€í™˜ì´ ë¶ˆê°€ëŠ¥í•œ None ê°’ì´ ìˆë‹¤ëŠ” ê²ƒì„ ì¶”ë¡ í•  ìˆ˜ ìˆì—ˆë‹¤.
Dataset.mep()ê³¼ ë¹„ìŠ·í•œ ë°©ì‹ìœ¼ë¡œ ì‘ë™í•˜ê³ , ë°ì´í„°ì…‹ì˜ í•œ ê°€ì§€ ì˜ˆì‹œë¥¼ ë°›ëŠ” í•¨ìˆ˜ì¸ Dataset.filter()ì„ ì‚¬ìš©í•´ì„œ Noneê°’ì„ ê°€ì§€ëŠ” í–‰ì„ ì‚­ì œí•´ë³´ì.

``` python
def filter_noise(x):
    return x["condition"] is not None
```

ê·¸ ë‹¤ìŒì—, drug_dataset.filter(filter_nones)ë¥¼ *lambda* í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ì„œ í•œ ì¤„ë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤.
Pythonì—ì„œëŠ”, lambda í•¨ìˆ˜ë¥¼ ë”±íˆ ëª…ëª…í•˜ì§€ ì•Šê³  ì‘ì€ í•¨ìˆ˜ì²˜ëŸ¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
ì¼ë°˜ì ìœ¼ë¡œ ë‹¤ìŒê³¼ ê°™ì´ ì‚¬ìš©í•œë‹¤.

``` python
lambda <arguments> : <expression>
```

ì—¬ê¸°ì„œ lambdaëŠ” Pythonì˜ íŠ¹ë³„í•œ í‚¤ì›Œë“œì´ê³ , <arguments>ëŠ” ì‰¼í‘œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë‚˜ëˆ ì§€ëŠ” ê°’ìœ¼ë¡œ í•¨ìˆ˜ì— ëŒ€í•œ ì…ë ¥ì„ ì •ì˜í•˜ê³ , <expression>ì€ ì‹¤í–‰í•  ì—°ì‚°ì„ í‘œí˜„í•œë‹¤.
ì˜ˆë¥¼ ë“¤ì–´, ìˆ«ìë¥¼ ì œê³±í•˜ëŠ” ê°„ë‹¨í•œ ì—°ì‚°ì„ lambdaë¥¼ ì‚¬ìš©í•˜ì—¬ ë‹¤ìŒê³¼ ê°™ì´ ì •ì˜í•  ìˆ˜ ìˆë‹¤.
  
``` python
lambda x : x * x
```

